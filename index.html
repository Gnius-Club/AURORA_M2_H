<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A.U.R.O.R.A. Misión 2: Protocolo de Optimización Energética</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=VT323:wght@400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Header -->
    <header class="header" id="header">
        <div class="container">
            <h1 class="header__title">A.U.R.O.R.A. MISIÓN 2: PROTOCOLO DE OPTIMIZACIÓN ENERGÉTICA</h1>
            <div class="header__status">
                <span class="status-indicator" id="connection-status">● ENLACE ESTABLECIDO</span>
                <span class="mission-timer" id="mission-timer">00:00:00.000</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content" id="main-content">
        <div class="container">
            <div class="game-grid">
                <!-- Left Panel: Tactical Map -->
                <section class="tactical-map-panel" id="tactical-map">
                    <div class="panel">
                        <div class="panel__header">
                            <h2>MAPA TÁCTICO</h2>
                            <div class="panel__controls">
                                <button class="btn btn--outline btn--sm" id="zoom-in">+</button>
                                <button class="btn btn--outline btn--sm" id="zoom-out">-</button>
                            </div>
                        </div>
                        <div class="panel__body">
                            <div class="map-container">
                                <div class="grid" id="tactical-grid"></div>
                                <div class="map-legend">
                                    <div class="legend-item">
                                        <span class="legend-symbol rover-symbol">R</span>
                                        <span>Rover A.U.R.O.R.A.</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-symbol sample-symbol">S1/S2</span>
                                        <span>Muestras Científicas</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-symbol mapping-symbol">M1/M2</span>
                                        <span>Zonas de Mapeo</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-symbol recharge-symbol">⚡</span>
                                        <span>Estación de Recarga</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-symbol extraction-symbol">E</span>
                                        <span>Punto de Extracción</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Center Panel: Command Sequencer -->
                <section class="sequencer-panel" id="sequencer-panel">
                    <div class="panel">
                        <div class="panel__header">
                            <h2>SECUENCIADOR DE COMANDOS</h2>
                            <button class="btn btn--outline btn--sm" id="clear-sequence">LIMPIAR</button>
                        </div>
                        <div class="panel__body">
                            <div class="command-bank">
                                <h3>Banco de Comandos</h3>
                                <div class="command-blocks" id="command-bank">
                                    <!-- Command blocks will be generated by JavaScript -->
                                </div>
                            </div>
                            <div class="sequence-area">
                                <h3>Plan de Operaciones</h3>
                                <div class="drop-zone" id="operation-sequence">
                                    <div class="drop-zone__placeholder">
                                        Arrastra comandos aquí para crear tu secuencia
                                    </div>
                                </div>
                            </div>
                            <div class="execute-section">
                                <button class="btn btn--primary btn--lg btn--full-width" id="execute-plan">
                                    [ SIMULAR Y EJECUTAR PLAN ]
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Right Panel: Resource Diagnostics -->
                <section class="diagnostics-panel" id="energy-panel">
                    <div class="panel">
                        <div class="panel__header">
                            <h2>DIAGNÓSTICO DE ENERGÍA</h2>
                            <div class="energy-status" id="energy-percentage">100%</div>
                        </div>
                        <div class="panel__body">
                            <div class="energy-bar-container">
                                <div class="energy-bar">
                                    <div class="energy-fill" id="energy-fill"></div>
                                    <div class="energy-markers">
                                        <div class="marker" style="bottom: 80%;">80</div>
                                        <div class="marker" style="bottom: 60%;">60</div>
                                        <div class="marker" style="bottom: 40%;">40</div>
                                        <div class="marker" style="bottom: 20%;">20</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="cost-analysis" id="cost-analysis">
                                <h3>Análisis de Costes</h3>
                                <div class="cost-list">
                                    <div class="cost-item">avanzar(1): <span class="cost-value">-3%</span></div>
                                    <div class="cost-item">girar(): <span class="cost-value">-1%</span></div>
                                    <div class="cost-item">recogerMuestra(): <span class="cost-value">-5%</span></div>
                                    <div class="cost-item">mapearTerreno(): <span class="cost-value">-4%</span></div>
                                    <div class="cost-item">recargarEnergia(): <span class="cost-value cost-positive">+40%</span></div>
                                    <div class="cost-item">enviarReporte(): <span class="cost-value">-2%</span></div>
                                </div>
                            </div>

                            <div class="objectives-panel" id="objectives-panel">
                                <h3>Objetivos de la Misión</h3>
                                <div class="objectives-list" id="objectives-list">
                                    <!-- Objectives will be generated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- Tutorial Modal -->
    <div class="modal hidden" id="tutorial-modal">
        <div class="modal__backdrop"></div>
        <div class="modal__content modal__content--large">
            <div class="modal__header">
                <h2 id="tutorial-title">Tutorial</h2>
                <div class="tutorial-progress">
                    <span id="tutorial-step">1</span> / <span id="tutorial-total">7</span>
                </div>
            </div>
            <div class="modal__body">
                <p id="tutorial-description">Descripción del tutorial</p>
            </div>
            <div class="modal__footer">
                <button class="btn btn--outline" id="tutorial-prev" disabled>ANTERIOR</button>
                <button class="btn btn--primary" id="tutorial-next">SIGUIENTE</button>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal hidden" id="success-modal">
        <div class="modal__backdrop"></div>
        <!-- CAMBIO: Se añade un id al contenido para poder capturarlo -->
        <div class="modal__content modal__content--large success-screen" id="success-certificate">
            <div class="success-animation">
                <div class="success-glow"></div>
                <h2 class="success-title">MISIÓN CUMPLIDA</h2>
                <div class="success-efficiency">
                    Eficiencia Energética: <span id="final-efficiency">0%</span>
                </div>
                <!-- CAMBIO: Nuevo elemento para mostrar el tiempo final -->
                <div class="success-time">
                    Tiempo de Misión: <span id="final-mission-time">00:00:00.000</span>
                </div>
            </div>
            <div class="success-message" id="success-message">
                <!-- Success message will be typed here -->
            </div>
            <div class="modal__footer">
                <!-- CAMBIO: Nuevo botón para descargar la captura -->
                <button class="btn btn--outline" id="download-screenshot">Descargar Certificado</button>
                <button class="btn btn--primary" id="restart-game">NUEVA MISIÓN</button>
            </div>
        </div>
    </div>

    <!-- Failure Modal -->
    <div class="modal hidden" id="failure-modal">
        <div class="modal__backdrop"></div>
        <div class="modal__content modal__content--large failure-screen">
            <div class="failure-animation">
                <div class="signal-lost">SEÑAL PERDIDA</div>
                <h2 class="failure-title">MISIÓN FALLIDA</h2>
            </div>
            <div class="failure-message" id="failure-message">
                <!-- Failure message will be shown here -->
            </div>
            <div class="modal__footer">
                <button class="btn btn--primary" id="retry-mission">REINTENTAR MISIÓN</button>
            </div>
        </div>
    </div>

    <!-- Command Parameter Modal -->
    <div class="modal hidden" id="parameter-modal">
        <div class="modal__backdrop"></div>
        <div class="modal__content">
            <div class="modal__header">
                <h2 id="parameter-title">Configurar Comando</h2>
            </div>
            <div class="modal__body">
                <div class="form-group">
                    <label class="form-label" id="parameter-label">Parámetro:</label>
                    <input type="text" class="form-control" id="parameter-input" placeholder="Ingresa el valor">
                    <div class="parameter-help" id="parameter-help"></div>
                </div>
            </div>
            <div class="modal__footer">
                <button class="btn btn--outline" id="parameter-cancel">CANCELAR</button>
                <button class="btn btn--primary" id="parameter-confirm">CONFIRMAR</button>
            </div>
        </div>
    </div>

    <!-- CAMBIO: Librería para capturar la pantalla -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
